---
title: "Plate reader growth curves of GAT201 targets in RPMI"
author: "Liz Hughes & Edward Wallace"
date: "16/05/2023"
output:
  html_document:
    toc: yes
    toc_depth: 2
---

```{r call_shared_functions_formatting, child = "shared_functions_formatting.Rmd"}
```

# Summary

Plate reader growth curves of GAT201 targets 20230308

Design:

- WT KN99-alpha, gat201∆, gat204∆, liv3∆, blp1∆, all from Madhani deletion collection
- 4 Biological replicates, 3 Technical replicates each.
- Grow 5ml culture from colony (1 colony = 1 Biorep) in YPD, 30C, 180 rpm ON.
- Seed at OD 600nm = 0.2 , 200 ul per well.
- Grow in RPMI at 37 degrees C.
- Run for 2 days (283 cycles).


# Set up data frame of nice strain names, colours, styles.

```{r nice_names}
strain_df <- tibble( 
                    Strain = c("KN99 (WT)", "GAT201", "GAT204", "LIV3", "BLP1"),
                    Strain_nice =  c("WT", "gat201∆", "gat204∆", "liv3∆", "blp1∆"),
                    colour = c("grey20", "darkred", "#d95f02", "#1b9e77",   "#7570b3"))

scale_color_strain <- 
  scale_color_manual("Strain",
                     breaks = strain_df$Strain_nice,
                     values = strain_df$colour)
```


## Read in transposed data as csv file

```{r load_rawod}
rawod <-
  here::here("data", "20230308_RPMI_Gat201Targets_Plate1.xlsx") %>%
  read_platereader_xlsx(start_row = 52)
```

## Read in the Plate map data from csv file

Also combine with nice strain names for display.

```{r load_platemap}
platemap <- 
  here::here("data", "20230308_RPMI_Gat201Targets_Plate1_setup.csv") %>%
  read_platemap_csv(strain_df = strain_df) 

head(platemap, n=10)

```

## Reshape data and combine with the plate map, pairing them by Well

```{r reshape_annotate}
annotated <- 
  reshape_annotate_rawod(rawod = rawod, platemap = platemap)
```

## Plot blank ODs

To find how stable the ODs of the blank wells are.

```{r plot_blank_ODs, fig.width = 5, fig.height = 4}
ggplot(data=filter(annotated, is.na(Strain)),
       aes(x=Time, y=OD595,  group = Well)) + 
  geom_line() + 
  scale_time_hrs(limits = c(0, 48)) + 
  scale_y_continuous(limits = c(0, 0.2),
                     expand = c(0, 0),
                     breaks = c(0, 0.05, 0.1, 0.15)) +
  labs(title = "Blank wells RPMI", x="Time (hours)", y="Absorbance at 595 nm")
```

This shows that the OD increases over time, presumably pH change of the phenol red indicator. We correct for this.

## Calculate median OD for blank wells

```{r calc_blank_medians}
# filter out columns 1 and 12 as well?
blank_OD_summary <- 
  summarise_OD_fixed(annotated, od.name = "OD595",
                     is.na(Strain)) 

print(blank_OD_summary)

blank_OD_time <- 
  summarise_OD_bytime(annotated, od.name = "OD595",
                     is.na(Strain)) 

print(blank_OD_time)
```

## Subtract blank OD to make corrected OD

```{r subtract_blank_OD}
normalisedOD <- 
  normalise_OD_2ways(annotated, is.na(Strain))
```

## Plot OD corrected by time-based median summary

```{r plot_all_stat_summary, fig.width = 5, fig.height = 3.75}
RPMI_plot <- ggplot(data = normalisedOD %>%
                      filter(!is.na(Strain)), 
                    aes(x = Time, y = OD_corrected_time, color = Strain_nice)) + 
  geom_line(aes(group = Well), size = 0.2, alpha = 0.2) + 
  stat_summary(fun = "median", geom = "line", linewidth = 1) +
  scale_time_hrs(limits = c(0, 48)) + 
  scale_y_continuous(limits = c(0, 0.1),
                     expand = c(0, 0),
                     breaks = c(0, 0.05, 0.1)) +
  labs(y = "OD595") +
  scale_color_strain

RPMI_plot
```


```{r save_png_summary}
here::here("results",
           "20230308_RPMI_Gat201Targets_Plate1_summaryplot.png") %>%
  ggsave(plot = RPMI_plot,
         width = 5, height = 3.75)
```

## Plot OD corrected by time-based median summary, smoothed

```{r plot_all_stat_spline, fig.width = 5, fig.height = 3.75}
library(ggformula)
RPMI_plot <- ggplot(data = normalisedOD %>%
                      filter(!is.na(Strain)), 
                    aes(x = Time, y = OD_corrected_time, color = Strain_nice)) + 
  # geom_line(aes(group = Well), size = 0.2, alpha = 0.2) + 
  # stat_smooth(size = 1, n = 20, se = FALSE) +
  ggformula::stat_spline(linewidth = 1) + 
  scale_time_hrs(limits = c(0, 48)) + 
  scale_y_continuous(limits = c(0, 0.1),
                     expand = c(0, 0),
                     breaks = c(0, 0.05, 0.1)) +
  labs(y = "OD595") +
  scale_color_strain

RPMI_plot
```

```{r save_png_spline}
here::here("results",
           "20230308_RPMI_Gat201Targets_Plate1_splineplot.png") %>%
  ggsave(plot = RPMI_plot,
         width = 5, height = 3.75)
```

# Session info for reproducibility

```{r session_info}
sessionInfo()
```



















